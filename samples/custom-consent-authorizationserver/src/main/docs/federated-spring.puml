@startuml
actor "Client App" as Guest
participant "Accesso Identity Service" as IDsvc
participant "External Auth Service" as Auth0

...

Guest -> IDsvc: OAuth2 Authorization Requests
activate IDsvc
IDsvc -> IDsvc: redirect to spring-security-client\nlib via URL
activate IDsvc

IDsvc --> Guest: Redirect browser to external login page
Guest -> Auth0: OAuth2 Authorization Requests
Auth0 -> Auth0: Positively Authenticates guest\nand confirms desired scope of access
Auth0 --> IDsvc: Redirects with authorization_code\n back to URL in auth service

IDsvc -> Auth0: /token?grant_type=authorization_code\nwith private client credentials
Auth0 --> IDsvc: issued id, access, and refresh tokens
deactivate IDsvc
alt if Have never seen this user
IDsvc -> IDsvc: create TE2 user based on idtoken
end
IDsvc -> IDsvc: save Authentication data in DB
IDsvc --> Guest: redirect to client with authorization_code
deactivate IDsvc
Guest -> IDsvc: /token?grant_type=authorization_code\nwith private client credentials
activate IDsvc
IDsvc --> Guest: access and refresh tokens
deactivate IDsvc
...

@enduml
